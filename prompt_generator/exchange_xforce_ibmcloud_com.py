from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC


def generate_prompt(url: str):

    prompt = '''
I will give you some information about a software vulnerability. The information includes these parts: title, detail, consequences, remedy and parameters, followed by {Title}, {Detail}, {Consequences}, {Remedy} and {Parameters}respectively. Note that some parts may not exist. You need to extract the valuable parts from the information. The focus is on the information section describing the vulnerability.\n\n'''[1:]

    driver = webdriver.Chrome()
    driver.get(url)

    element = WebDriverWait(driver, 10).until(
        EC.presence_of_element_located((By.ID, 'searchresults'))
    )

    # content = driver.page_source
    # with open('./test/test.html', 'w') as f:
    #     print(content, file=f)

    title = driver.find_element(By.CLASS_NAME, 'reportid').text
    # print(title)
    prompt += '{Title}:\n' + title + '\n\n'

    detail1 = driver.find_element(By.CLASS_NAME, 'detailsline').text
    detail2 = driver.find_element(By.CLASS_NAME, 'description').text
    # print(detail1)
    # print(detail2)
    prompt += '{Detail}:\n' + detail1 + '\n' + detail2 + '\n\n'

    titles = ['{Consequences}:\n', '{Remedy}:\n', '{Parameters}:\n']
    info = driver.find_elements(By.CLASS_NAME, 'detailssubsection')
    # print(len(info))
    for index, item in enumerate(info):
        # print(item.text)
        prompt += titles[index] + item.text + '\n\n'

    driver.quit()

    return prompt

if __name__ == '__main__':
    url = 'https://exchange.xforce.ibmcloud.com/vulnerabilities/83347'
    prompt = generate_prompt(url)
    if prompt != None:
        with open('./prompt_template/prompt_test/exchange.xforce.ibmcloud.com', 'w') as f:
            print(prompt, file = f)