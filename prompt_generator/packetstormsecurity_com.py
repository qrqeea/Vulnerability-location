import requests
from bs4 import BeautifulSoup

def generate_prompt(url: str):

    prompt = '''
I will give you some information about a software vulnerability. The information includes these parts: title, description and code, followed by {Title}, {Description} and {Code} respectively. Note that some parts may not exist. You need to extract the valuable parts from the information. The focus is on the information section describing the vulnerability.\n\n'''[1:]

    res = requests.get(url)
    soup = BeautifulSoup(res.text, 'html.parser')

    try:
        info = soup.dl.dt
        if info != None:
            # print(info.text)
            prompt += '{Title}:\n' + info.text + '\n\n'

        info = soup.find(name = 'dd', attrs = {
            'class' : 'detail',
        })
        if info != None:
            # print(info.text)
            prompt += '{Description}:\n' + info.text + '\n\n'

        info = soup.find(name = 'div', attrs = {
            'class' : 'src',
        })
        if info != None:
            # print(info.text)
            prompt += '{Code}:' + info.text
    except Exception as e:
        return None
    
    return prompt

if __name__ == '__main__':
    url = 'https://packetstormsecurity.com/files/123454/'
    prompt = generate_prompt(url)
    if prompt != None:
        with open('./prompt_template/prompt_test/packetstormsecurity.com', 'w') as f:
            print(prompt, file = f)