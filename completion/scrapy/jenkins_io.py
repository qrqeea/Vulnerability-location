import requests
from bs4 import BeautifulSoup
from util import format_text


def scrapy(url: str):

    res = ''
    try:
        soup = BeautifulSoup(requests.get(url).text, 'html.parser')

        info = soup.find_all(name = 'div', attrs = {
            'class' : 'sect1',
        })

        if info == None:
            for item in info:
                res += item.h2.text + ':\n' + format_text(item.div.text) + '\n\n'
        else:
            info = soup.find(name = 'div', attrs = {
                'class' : 'col-lg-9',
            })
            target_tag = info.h2
            # print(target_tag.text)
            for sibling in target_tag.find_previous_siblings():
                sibling.extract()
            # print(handleText(info.text))
            res += format_text(info.text) + '\n\n'
    except Exception as e:
        return None

    return res

if __name__ == '__main__':
    url = 'https://www.jenkins.io/security/advisory/2019-09-12/#SECURITY-1538'
    res = scrapy(url)
    print(res)