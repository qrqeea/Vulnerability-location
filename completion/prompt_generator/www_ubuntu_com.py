import requests
from bs4 import BeautifulSoup

def handleText(input):
    # 以换行符为分隔符，将字符串分割成行
    lines = input.split('\n')

    # 去除每行前后的空格，并过滤掉空行
    stripped_lines = [line.strip() for line in lines if line.strip()]

    # 将处理后的内容合并为一个字符串
    result = '\n'.join(stripped_lines)
    return result

def generate_prompt(url: str):

    prompt = '''
I will give you some information about a software vulnerability. The information includes these parts: title and content, followed by {Title} and {Content} respectively. The content includes Releases, Packages, Details, Update instructions, References and Related notices. Note that some parts may not exist. You need to extract the valuable parts from the information. The focus is on the information section describing the vulnerability.\n\n'''[1:]
    
    res = requests.get(url)
    soup = BeautifulSoup(res.text, 'html.parser')
    # print(res.text)

    title = "{Title}:\n"
    try:
        info = soup.section.h1
        if info != None:
            title += info.text + '\n'
        info = soup.section.p.find_next(name = 'p')
        if info != None:
            title += info.text
        # print(title)
        prompt += title + '\n' + "{Content}:\n"

        info = soup.section.find_all(name = 'div', attrs = {
            'class' : 'row',
        })

        for index, item in enumerate(info):
            prompt += handleText(item.text)
            # print('--------------------------------------------------')
    except Exception as e:
        return None

    return prompt

if __name__ == '__main__':
    url = 'http://www.ubuntu.com/usn/USN-3096-1'
    prompt = generate_prompt(url)
    if prompt != None:
        with open('./prompt_template/prompt_test/www.ubuntu.com', 'w') as f:
            print(prompt, file = f)