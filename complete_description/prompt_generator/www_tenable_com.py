import requests
from bs4 import BeautifulSoup

def handleText(input):
    # 以换行符为分隔符，将字符串分割成行
    lines = input.split('\n')

    # 去除每行前后的空格，并过滤掉空行
    stripped_lines = [line.strip() for line in lines if line.strip()]

    # 将处理后的内容合并为一个字符串
    result = '\n'.join(stripped_lines)
    return result

def generate_prompt(url: str):

    prompt = '''
I will give you some information about a software vulnerability. The information includes these parts: Title, Risk Information, Solution, Additional References, Affected Products and Advisory Timeline. Note that some parts may not exist. You need to extract the valuable parts from the information. The focus is on the information section describing the vulnerability.\n\n'''[1:]

    res = requests.get(url)
    soup = BeautifulSoup(res.text, 'html.parser')

    info = soup.find(name = 'h1', attrs = {
        'class' : 'giga hmb',
    })
    if info != None:
        # print(info.text)
        prompt += 'Title: ' + info.text + '\n'

    info = soup.find(name = 'div', attrs = {
        'class' : 'onethird last',
    })
    if info != None:
        # print(info.text)
        prompt += handleText(info.text) + '\n\n'

    info = soup.find_all(name = 'div', attrs = {
        'class' : 'widget-container',
    })
    # print(len(info))
    for index, item in enumerate(info):
        # print(item.text)
        prompt += handleText(item.text) + '\n'
        
    return prompt

if __name__ == '__main__':
    url = 'https://www.tenable.com/security/tns-2016-21'
    prompt = generate_prompt(url)
    if prompt != None:
        with open('./prompt_template/prompt_test/www.tenable.com', 'w') as f:
            print(prompt, file = f)