import os
import sys
import tqdm
import pickle
import subprocess
# from util import load_pickle, save_text, save_pickle

# path = 'experiment_data/cleaned_gt_commit_single_v2.pkl'
# data = load_pickle(path)
# # print(len(data))

# count = 0
# path = 'experiment_data/267/target'
# cve_list = os.listdir(path)

# tp = {}
# for (cve, repo) in data:
#     if cve in cve_list:
#         if cve in tp:
#             tp[cve].append(repo)
#         else:
#             tp[cve] = [repo]

# # save_text('tp2', tp)

# valid_cve_list = []
# for cve in cve_list:
#     repo_list = os.listdir(f'{path}/{cve}')
#     for repo in repo_list:
#         repo_name = repo.replace('â€”', '/')
#         if repo_name in tp[cve]:
#             valid_cve_list.append(cve)

# print(len(valid_cve_list))
# save_pickle('valid_cve_list.pkl', valid_cve_list)
# save_text('valid_cve_list', valid_cve_list)




# path = '/Volumes/Data/experiment_data/267/procedure_data/cve_list_205.pkl'
# cve_list = load_pickle(path)

# for cve in cve_list:
#     path = f'/Volumes/Data/experiment_data/267/target/{cve}'
#     cmd = f'cd {path} && du -sh >> tmp/{cve}'

res = {}

path = '/Users/wangtao/Downloads/target'
for cve in tqdm.tqdm(os.listdir(path)):
    if cve[0] == '.':
        continue
    # print(f'current: {cve}')
    # cmd = f'cd {path}/{cve} && du -sh > /Volumes/Data/experiment_data/267/repo_size/{cve}'
    # print(cmd)
    # if os.system(cmd) != 0:
    #     print(f'error :{cve}')
    with open(f'/Volumes/Data/experiment_data/267/repo_size/{cve}', 'r') as f:
        s = f.read()
    if 'G'in s:
        s = float(s.split('G')[0].strip()) * 1024 * 1024
    elif 'M' in s:
        s = float(s.split('M')[0].strip()) * 1024
    elif 'K' in s:
        s = float(s.split('K')[0].strip())
    else:
        print(s)
    res[cve] = s

sorted_dict = dict(sorted(res.items(), key=lambda item: item[1]))
print(sorted_dict.keys())