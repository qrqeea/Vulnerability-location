import os
import sys
import pickle
from util import load_pickle, save_text, save_pickle

# path = 'experiment_data/cleaned_gt_commit_single_v2.pkl'
# data = load_pickle(path)
# # print(len(data))

# count = 0
# path = 'experiment_data/267/target'
# cve_list = os.listdir(path)

# tp = {}
# for (cve, repo) in data:
#     if cve in cve_list:
#         if cve in tp:
#             tp[cve].append(repo)
#         else:
#             tp[cve] = [repo]

# # save_text('tp2', tp)

# valid_cve_list = []
# for cve in cve_list:
#     repo_list = os.listdir(f'{path}/{cve}')
#     for repo in repo_list:
#         repo_name = repo.replace('â€”', '/')
#         if repo_name in tp[cve]:
#             valid_cve_list.append(cve)

# print(len(valid_cve_list))
# save_pickle('valid_cve_list.pkl', valid_cve_list)
# save_text('valid_cve_list', valid_cve_list)

path = 'experiment_data/cleaned_gt_commit_single_v2.pkl'
data = load_pickle(path)

path = 'experiment_data/267/valid_cve_list.pkl'
cve_list = load_pickle(path)

tp = {}
for (cve, repo_name), file_name in data.items():
    if cve in cve_list:
        tp[(cve, repo_name)] = file_name
save_text('experiment_data/267/groundtruth', tp)