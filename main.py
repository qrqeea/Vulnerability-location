from dataset.preprocessing_data import preprocessing_data
from scrapy.Scrapy import Scrapy
from completion.completion import Completion
from repository.RepositoryCollection import RepositoryCollection
from repository.RepositoryClone import RepositoryClone
from commit.CommitCollection import CommitCollection
from extraction.ComponentExtraction import ComponentExtraction
from candidate.CandidateSelection import CandidateSelection
from util.io_util import load_pickle


project_root_path = '/Volumes/Data/experiment_data'
cve_json_path = '/Volumes/Data/experiment_data/cve_json'
cpe_json_path = '/Volumes/Data/experiment_data/cpe_json'    


cve_data_all = preprocessing_data(
    load_pickle(f'{project_root_path}/ground_truth/cleaned_gt_commit_single_v2.pkl'),
    project_root_path,
    cve_json_path,
    cpe_json_path
)
# cve_list = list(cve_data_all.keys())
# print(len(cve_list))    # 8978

scrapy = Scrapy(
    project_root_path,
    f'{project_root_path}/scrapy',
    cve_data_all
)
scrapy.start()

# completion = Completion(
#     project_root_path,
#     f'{project_root_path}/completion',
#     load_pickle(f'{project_root_path}/cve_data_all.pkl'),
#     16385
# )
# completion.start()

# componentExtraction = ComponentExtraction(
#     project_root_path,
#     f'{project_root_path}/extraction',
#     f'{project_root_path}/completion/completion_result',
#     load_pickle(f'{project_root_path}/cve_data_all.pkl')
# )
# componentExtraction.start()

# repositoryCollection = RepositoryCollection(
#     project_root_path,
#     f'{project_root_path}/repository_collection',
#     load_pickle(f'{project_root_path}/cve_data_all.pkl')
# )
# repositoryCollection.start()

# commitCollection = CommitCollection(
#     project_root_path,
#     f'{project_root_path}/commit',
#     load_pickle(f'{project_root_path}/cve_data_all.pkl')
# )
# commitCollection.start()

# repositoryDownload = RepositoryClone(
#     f'{project_root_path}/repository_clone',
#     load_pickle(f'{project_root_path}/cve_data_all.pkl')
# )
# repositoryDownload.start()

# candidateSelection = CandidateSelection(
#     project_root_path,
#     f'{project_root_path}/candidate',
#     load_pickle(f'{project_root_path}/cve_data_all.pkl'),
#     load_pickle('/Volumes/NVD/experiment_data/datasets/repository_clone/repo_file_list.pkl')
# )
# candidateSelection.start()