import os
import tiktoken
from openai import OpenAI
from dotenv import load_dotenv

load_dotenv()

def query_openai(prompt: str, model = 'gpt-3.5-turbo-0125'):
    # 'gpt-4-turbo'

    client = OpenAI(api_key = os.environ.get('OPENAI_API_KEY'))

    chat_completion = client.chat.completions.create(
        messages = [
            {
                'role': 'user',
                'content': prompt,
            }
        ],
        model = model,
        temperature = 0
    )
    # print(chat_completion.choices[0].message.content)
    return chat_completion.choices[0].message.content


def calc_token(text, model = 'text-embedding-3-small'):
    # 'text-embedding-3-small'
    enc = tiktoken.get_encoding('cl100k_base')
    enc = tiktoken.encoding_for_model(model)
    return len(enc.encode(text))